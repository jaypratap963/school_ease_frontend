<div class="card">
  <div class="card-body">

    <h5 class="mb-3">Attendance</h5>

    <!-- Class -->
    <div class="mb-3">
      <label class="form-label">Class</label>
      <ng-select
        name="class"
        [items]="classes"
        bindLabel="class_name"
        bindValue="id"
        [(ngModel)]="selectedClassId"
        (change)="onClassOrDateChange()"
        placeholder="Select class"
        appendTo="body">

        <ng-template ng-label-tmp let-item="item">
          {{ item.class_name }} - {{ item.section }}
        </ng-template>

        <ng-template ng-option-tmp let-item="item">
          {{ item.class_name }} - {{ item.section }}
        </ng-template>

      </ng-select>
    </div>

    <!-- Date -->
    <div class="mb-3">
      <label class="form-label">Date</label>
      <input
        type="date"
        class="form-control"
        [(ngModel)]="selectedDate"
        (change)="onClassOrDateChange()"
      />
    </div>

    <div *ngIf="!isEditable" class="alert alert-warning">
      Attendance older than 2 days cannot be edited.
    </div>

    <div *ngIf="loading" class="text-center py-3">
      Loading attendance...
    </div>

    <!-- Students -->
    <div *ngIf="students.length">
      <div class="card mb-2" *ngFor="let student of students">
        <div class="card-body d-flex justify-content-between align-items-center">
          <span>{{ student.name }}</span>

          <div class="form-check form-switch">
            <input
              type="checkbox"
              class="form-check-input"
              [checked]="student.status === 'P'"
              (change)="onStatusToggle(student, $event)"
              [disabled]="!isEditable"
            />
            <label class="form-check-label ms-2">
              {{ student.status === 'P' ? 'Present' : 'Absent' }}
            </label>
          </div>
        </div>
      </div>

      <button
        class="btn bg-gradient-primary w-100 mt-3"
        *ngIf="isEditable"
        (click)="saveAttendance()">
        Save Attendance
      </button>
    </div>

  </div>
</div>
