<div class="card">
  <div class="card-body">

    <h5 class="mb-3">Enter Marks</h5>

    <!-- Class -->
    <div class="mb-3">
      <label class="form-label">Class</label>
      <ng-select
        [items]="classes"
        bindLabel="class_name"
        bindValue="id"
        [(ngModel)]="selectedClassId"
        (change)="onClassChange()"
        placeholder="Select class"
        appendTo="body">
      </ng-select>
    </div>

    <!-- Subject -->
    <div class="mb-3">
      <label class="form-label">Subject</label>
      <ng-select
        [items]="subjects"
        bindLabel="name"
        bindValue="id"
        [(ngModel)]="selectedSubjectId"
        (change)="onSubjectOrExamChange()"
        [disabled]="!selectedClassId"
        appendTo="body">
      </ng-select>
    </div>

    <!-- Exam -->
    <div class="mb-3">
      <label class="form-label">Exam</label>
      <ng-select
        [items]="exams"
        bindLabel="name"
        bindValue="id"
        [(ngModel)]="selectedExamId"
        (change)="onSubjectOrExamChange()"
        [disabled]="!selectedSubjectId"
        appendTo="body">
      </ng-select>
    </div>

    <div *ngIf="loadingStudents" class="text-center py-3">
      Loading students...
    </div>

    <div *ngIf="students.length">
      <div class="card mb-2" *ngFor="let student of students">
        <div class="card-body d-flex justify-content-between align-items-center">
          <span>{{ student.name }}</span>
          <input
            type="number"
            class="form-control w-25"
            [(ngModel)]="student.marks"
            [disabled]="isLocked"
          />
        </div>
      </div>

      <div class="mt-3">
        <button
          class="btn bg-gradient-primary me-2"
          *ngIf="!isLocked"
          (click)="saveMarks()">
          Save
        </button>

        <button
          class="btn bg-gradient-danger"
          *ngIf="!isLocked"
          (click)="lockMarks()">
          Lock
        </button>

        <div *ngIf="isLocked" class="alert alert-warning mt-2">
          Marks are locked and cannot be edited.
        </div>
      </div>
    </div>

  </div>
</div>
